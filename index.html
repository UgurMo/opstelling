<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Teamopstelling 3-3-1 – 4 kwarten (v3.7-touchfix)</title>
<style>
*{box-sizing:border-box}html,body{margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,sans-serif;color:#111}
header{padding:16px 20px;border-bottom:1px solid #eee}
h1{margin:0 0 4px;font-size:22px}.sub{margin:0;color:#555}
.controls{display:flex;justify-content:space-between;gap:16px;padding:10px 20px;align-items:center;border-bottom:1px solid #eee;flex-wrap:wrap}
button{padding:8px 12px;border:1px solid #ddd;background:#fff;border-radius:8px;cursor:pointer}
button:hover{border-color:#bbb}
.players{padding:16px 20px}
.players .scroll{overflow:auto;border:1px solid #eee;border-radius:8px}
table{border-collapse:collapse;width:100%;min-width:560px}
th,td{padding:10px;border-bottom:1px solid #f0f0f0;text-align:left}
th{background:#f5f7fb;position:sticky;top:0}
input[type="number"]{width:5rem}
select,input[type="text"],input[type="number"]{padding:6px;border:1px solid #ddd;border-radius:6px}
.hint{color:#666;margin-top:8px}
.quarters{display:grid;grid-template-columns:repeat(auto-fit,minmax(380px,1fr));gap:16px;padding:0 20px 20px}
.quarter{border:1px solid #eee;border-radius:12px;padding:12px}
.quarter h3{margin:6px 6px 12px;display:flex;justify-content:space-between;align-items:center}
.badge{font-size:12px;background:#fff3cd;border:1px solid #ffe08a;color:#664d03;padding:2px 6px;border-radius:6px}
.pitch{background:#e9f7e9;border:1px solid #cfe8cf;border-radius:12px;padding:12px;margin:8px}
.row{display:flex;gap:8px;justify-content:space-between;margin:8px 0}
.slot,.staging-slot{flex:1;min-height:44px;background:#fff;border:1px solid #c4dec4;border-radius:8px;display:flex;align-items:center;justify-content:center;padding:6px;text-align:center;cursor:grab;touch-action:none;-webkit-user-select:none;user-select:none}
.slot.wide,.staging-slot.wide{flex:2}
.row.staging .staging-slot{background:#f8fff8;border-style:dashed}
.reserves{padding:8px;background:#e7f3ff;border:1px solid #bcd6f8;border-radius:10px}
.reserve-list{display:flex;flex-direction:column;gap:6px;min-height:44px;border:1px dashed #bcd6f8;border-radius:8px;padding:8px;background:#e7f3ff}
.reserve-item{padding:6px 8px;border:1px solid #bcd6f8;border-radius:6px;background:#e7f3ff;cursor:grab;touch-action:none;-webkit-user-select:none;user-select:none}
.droppable{box-shadow:0 0 0 2px #a3d2a3 inset}
.drag-chip{position:fixed;pointer-events:none;z-index:9999;padding:6px 10px;border:1px solid #bcd6f8;background:#e7f3ff;border-radius:999px;box-shadow:0 6px 18px rgba(0,0,0,.2)}
</style>
</head>
<body>
<header><h1>Teamopstelling 3-3-1 – 4 kwarten</h1><p class="sub">8 spelers (incl. keeper) · 11 totaal</p></header>
<section class="controls">
<div class="left">
<button id="generateBtn">Opstellingen genereren</button>
<button id="saveBtn">Opslaan</button>
<button id="loadDefaultsBtn">Laad standaardteam</button>
<button id="resetBtn">Reset</button>
</div>
<div class="right">
<label><input type="checkbox" id="lockDrag"> Vergrendel</label>
</div>
</section>

<section class="quarters" id="quarters"></section>

<footer><p>v3.7-touchfix · Werkt offline · iOS-touch ondersteund</p></footer>

<script>
const DEFAULT_PLAYERS=[
{name:'Jim',role:'Keeper'},
{name:'Levi',role:'Veldspeler'},
{name:'Lou',role:'Veldspeler'},
{name:'Kanis',role:'Veldspeler'},
{name:'Zeid',role:'Veldspeler'},
{name:'Remy',role:'Veldspeler'},
{name:'Ali',role:'Veldspeler'},
{name:'Devaino',role:'Veldspeler'},
{name:'Nova',role:'Veldspeler'},
{name:'Sam',role:'Veldspeler'},
{name:'Aiden',role:'Veldspeler'}
];
const qNames=['q1','q2','q3','q4'];
const quartersEl=document.getElementById('quarters');
const layout=['d1','d2','d3','m1','m2','m3','f1'];
qNames.forEach(q=>{
  const div=document.createElement('div');
  div.className='quarter';
  div.innerHTML=`<h3>${q.toUpperCase()}</h3>
  <div class="pitch">
  <div class="row"><div class="slot wide" data-slot="${q}-gk">—</div></div>
  <div class="row">${layout.slice(0,3).map(p=>`<div class="slot" data-slot="${q}-${p}">—</div>`).join('')}</div>
  <div class="row">${layout.slice(3,6).map(p=>`<div class="slot" data-slot="${q}-${p}">—</div>`).join('')}</div>
  <div class="row"><div class="slot wide" data-slot="${q}-f1">—</div></div>
  </div>
  <div class="reserves"><h4>Reserves</h4><div class="reserve-list" data-quarter="${q}"></div></div>`;
  quartersEl.appendChild(div);
});
function appendToReserve(q,name){
  const list=document.querySelector(`.reserve-list[data-quarter="${q}"]`);
  const d=document.createElement('div');
  d.className='reserve-item';
  d.textContent=name;
  d.dataset.name=name;
  list.appendChild(d);
  bindTouchDrag(d,'reserve',q);
}
function removeNameFromQuarter(q,name){
  document.querySelectorAll(`[data-slot^="${q}-"]`).forEach(el=>{if(el.textContent===name){el.textContent='—';}});
  document.querySelectorAll(`.reserve-list[data-quarter="${q}"] .reserve-item`).forEach(el=>{if(el.textContent===name)el.remove();});
}

/* ---- TOUCH DRAG ---- */
let drag=null;
function makeChip(name){const c=document.createElement('div');c.className='drag-chip';c.textContent=name;document.body.appendChild(c);return c;}
function moveChip(c,x,y){c.style.left=(x+10)+'px';c.style.top=(y+10)+'px';}
function bindTouchDrag(el,source,q){
  el.addEventListener('touchstart',e=>{
    if(document.getElementById('lockDrag').checked)return;
    const name=el.textContent.trim();if(!name||name==='—')return;
    drag={name,source,q,origin:el,chip:makeChip(name)};
    e.preventDefault();
  },{passive:false});
  el.addEventListener('touchmove',e=>{
    if(!drag)return;const t=e.touches[0];moveChip(drag.chip,t.clientX,t.clientY);e.preventDefault();
  },{passive:false});
  el.addEventListener('touchend',e=>{
    if(!drag)return;const t=e.changedTouches[0];const target=document.elementFromPoint(t.clientX,t.clientY);
    if(target){
      const slot=target.closest('.slot');
      const list=target.closest('.reserve-list');
      if(slot && slot.dataset.slot.startsWith(drag.q+'-')){
        const prev=slot.textContent;
        if(drag.source!=='reserve')drag.origin.textContent='—';else drag.origin.remove();
        if(prev&&prev!=='—')appendToReserve(drag.q,prev);
        slot.textContent=drag.name;
      }else if(list && list.dataset.quarter===drag.q){
        if(drag.source!=='reserve'){drag.origin.textContent='—';appendToReserve(drag.q,drag.name);}
      }
    }
    drag.chip.remove();drag=null;
  });
}
/* ---- INIT ---- */
function init(){
  DEFAULT_PLAYERS.forEach((p,i)=>{
    if(i<8){
      const slot=document.querySelector(`[data-slot="q1-${i===0?'gk':layout[i-1]}"]`);
      if(slot)slot.textContent=p.name;
    }else appendToReserve('q1',p.name);
  });
  document.querySelectorAll('.slot').forEach(el=>bindTouchDrag(el,'slot',el.dataset.slot.split('-')[0]));
  document.querySelectorAll('.reserve-item').forEach(el=>bindTouchDrag(el,'reserve',el.closest('.reserve-list').dataset.quarter));
}
init();
</script>
</body>
</html>

<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Teamopstelling 3-3-1 – 4 kwarten (v3.8-touchdrag)</title>
<style>
*{box-sizing:border-box}html,body{margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,sans-serif;color:#111}
header{padding:16px 20px;border-bottom:1px solid #eee}
h1{margin:0 0 4px;font-size:22px}.sub{margin:0;color:#555}
.quarters{display:grid;grid-template-columns:repeat(auto-fit,minmax(380px,1fr));gap:16px;padding:20px}
.quarter{border:1px solid #eee;border-radius:12px;padding:12px}
.pitch{background:#e9f7e9;border:1px solid #cfe8cf;border-radius:12px;padding:12px;margin:8px 0}
.row{display:flex;gap:8px;justify-content:space-between;margin:8px 0}
.slot,.staging-slot{flex:1;min-height:44px;background:#fff;border:1px solid #c4dec4;border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:grab;touch-action:none;-webkit-user-select:none;user-select:none}
.slot.wide,.staging-slot.wide{flex:2}
.reserves{padding:8px;background:#e7f3ff;border:1px solid #bcd6f8;border-radius:10px}
.reserve-list{display:flex;flex-direction:column;gap:6px;min-height:44px;border:1px dashed #bcd6f8;border-radius:8px;padding:8px;background:#e7f3ff}
.reserve-item{padding:6px 8px;border:1px solid #bcd6f8;border-radius:6px;background:#e7f3ff;cursor:grab;touch-action:none;-webkit-user-select:none;user-select:none}
.droppable{box-shadow:0 0 0 2px #a3d2a3 inset}
/* tap-select cues */
.reserve-item.selected{outline:2px solid #6ab1ff}
.slot.tap-target,.staging-slot.tap-target,.reserve-list.tap-target{box-shadow:0 0 0 2px #6ab1ff inset}
.drag-chip{position:fixed;pointer-events:none;z-index:9999;padding:6px 10px;border:1px solid #bcd6f8;background:#e7f3ff;border-radius:999px;box-shadow:0 6px 18px rgba(0,0,0,.2)}
</style>
</head>
<body>
<header><h1>Teamopstelling 3-3-1 – 4 kwarten</h1><p class="sub">8 spelers (incl. keeper) · 11 totaal</p></header>

<section class="quarters" id="quarters"></section>

<script>
const PLAYERS=["Jim","Levi","Lou","Kanis","Zeid","Remy","Ali","Devaino","Nova","Sam","Aiden"];
const layout=['d1','d2','d3','m1','m2','m3','f1'];
const qNames=['q1','q2','q3','q4'];
const quarters=document.getElementById('quarters');

/* bouw veld */
qNames.forEach(q=>{
  const div=document.createElement('div');
  div.className='quarter';
  div.innerHTML=`<h3>${q.toUpperCase()}</h3>
  <div class="pitch">
    <div class="row"><div class="slot wide" data-slot="${q}-gk">—</div></div>
    <div class="row">${layout.slice(0,3).map(p=>`<div class="slot" data-slot="${q}-${p}">—</div>`).join('')}</div>
    <div class="row">${layout.slice(3,6).map(p=>`<div class="slot" data-slot="${q}-${p}">—</div>`).join('')}</div>
    <div class="row"><div class="slot wide" data-slot="${q}-f1">—</div></div>
  </div>
  <div class="reserves"><h4>Reserves</h4><div id="${q}-res" class="reserve-list" data-quarter="${q}"></div></div>`;
  quarters.appendChild(div);
});

/* helpers */
function appendToReserve(q,name){
  const list=document.getElementById(`${q}-res`);
  const d=document.createElement('div');d.className='reserve-item';d.textContent=name;d.dataset.name=name;
  list.appendChild(d);
  hookReserveDnD(d,q);
  hookReserveTap(d,q);
}
function removeNameFromQuarter(q,name){
  document.querySelectorAll(`[data-slot^="${q}-"]`).forEach(el=>{if(el.textContent===name)el.textContent='—';});
  document.querySelectorAll(`#${q}-res .reserve-item`).forEach(el=>{if(el.textContent===name)el.remove();});
}

/* ---- drag voor veld en reserves ---- */
function hookSlotDnD(slot){
  slot.draggable=true;
  slot.addEventListener('dragstart',e=>{
    e.dataTransfer.setData('text/plain',slot.textContent);
    window.dragInfo={name:slot.textContent,q:slot.dataset.slot.split('-')[0],origin:slot};
  });
  slot.addEventListener('dragover',e=>{
    const d=window.dragInfo;if(!d)return;
    if(d.q!==slot.dataset.slot.split('-')[0])return;
    e.preventDefault();slot.classList.add('droppable');
  });
  slot.addEventListener('dragleave',()=>slot.classList.remove('droppable'));
  slot.addEventListener('drop',e=>{
    e.preventDefault();const d=window.dragInfo;if(!d)return;
    const to=slot.textContent,q=d.q;
    if(to&&to!=='—'){appendToReserve(q,to);}
    removeNameFromQuarter(q,d.name);
    slot.textContent=d.name;
    slot.classList.remove('droppable');window.dragInfo=null;
  });
}
function hookReserveDnD(div,q){
  div.draggable=true;
  div.addEventListener('dragstart',e=>{
    e.dataTransfer.setData('text/plain',div.textContent);
    window.dragInfo={name:div.textContent,q,origin:div};
  });
}
function enableDnD(){
  document.querySelectorAll('.slot').forEach(hookSlotDnD);
}

/* ---- tap select (iOS) ---- */
let tapSel=null;
function clearTapState(){
  document.querySelectorAll('.selected').forEach(e=>e.classList.remove('selected'));
  document.querySelectorAll('.tap-target').forEach(e=>e.classList.remove('tap-target'));
  tapSel=null
